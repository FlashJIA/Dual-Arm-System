xhost +local:docker

docker run --rm -it \
  --net=host \
  -e DISPLAY=$DISPLAY \
  -v /tmp/.X11-unix:/tmp/.X11-unix \
  -v ~/workspace:/root/workspace \
  --gpus all \
  --name ros2_lab06 \
  gitlab-registry.oit.duke.edu/introtorobotics/mems-robotics-toolkit:kinova-jazzy-latest bash

cd ~/workspace/sj473_robotics_fall2025/final/ros2_ws

colcon build --symlink-install
source install/setup.bash

1 gazebo
ros2 launch final_moveit dual_gen3_lite.launch.py

2 new terminal controller and table
./start_lab.sh
./spawn.sh 

3rviz
source install/setup.bash
ros2 launch final_moveit dual_moveit.launch.py

4 camera
4.1 add camera to gazebo
ros2 run ros_gz_sim create \
  -file ~/workspace/sj473_robotics_fall2025/final/ros2_ws/src/final_moveit/sdf/depth_cam.sdf \
  -name sim_depth_camera \
  -x 0.42 -y 0 -z 1.0 \
  -R 0 -P 1.5708 -Y 0

4.2 bridge
ros2 run ros_gz_bridge parameter_bridge \
/sim/camera/image@sensor_msgs/msg/Image@gz.msgs.Image \
/sim/camera/depth_image@sensor_msgs/msg/Image@gz.msgs.Image \
/sim/camera/camera_info@sensor_msgs/msg/CameraInfo@gz.msgs.CameraInfo


4.3 point cloud
ros2 run depth_image_proc point_cloud_xyz_node \
  --ros-args \
  -p use_sim_time:=true \
  -p reliability_policy:=best_effort \
  -r image_rect:=/sim/camera/depth_image \
  -r camera_info:=/sim/camera/camera_info \
  -r points:=/points

4.4 transform 
ros2 run tf2_ros static_transform_publisher \
  --x 0.42 --y 0 --z 1.0 \
  --yaw -1.5708 --pitch 0 --roll -3.14159 \
  --frame-id world \
  --child-frame-id sim_depth_camera/camera_link/rgbd


5 script
cd ~/workspace/sj473_robotics_fall2025/final/ros2_ws/src/final_moveit/scripts/
 python3 perception_data.py
python3 src/final_moveit/final_moveit/scripts/perception_data.py

colcon build --packages-select final_moveit && source install/setup.bash

ros2 run final_moveit dual_arm_tasks --ros-args -p task:=retract
ros2 run final_moveit dual_arm_tasks --ros-args -p task:=home
ros2 run final_moveit dual_arm_tasks --ros-args -p task:=pick_cruise_place


python3 src/final_moveit/final_moveit/scripts/generate_game_script.py